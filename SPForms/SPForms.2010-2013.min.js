var __extends,SPForms;(function(n){var i=function(){function i(n){this.fields=[];this.form=$("#"+n)}return i.init=function(n){var t=new i(n);return t.initialize(),t},i.prototype.reloadFields=function(){var t=this;this.fields=[];this.form.find("[data-form-field]").each(function(i,r){var u=n.FormFields.FormField.getFormField($(r));t.fields.push(u)});this.populateFieldsFromQueryString();this.loadProfileData()},i.prototype.initialize=function(){var n=this.form.attr("data-form-settings");this.settings=n!==null&&n!==undefined?JSON.parse(n):null;this.reloadFields();this.wireUpEvents()},i.prototype.wireUpEvents=function(){var n=this;this.form.find("[data-form-submit]").click(function(t){var i=$(t.target),u=i.attr("data-form-submit-list"),r;if($("[data-form-field]").removeClass("form-invalid"),$("[data-form-field]").tooltip(),$("[data-form-field]").tooltip("option","disabled",!0),!n.validateControls()){r=i.attr("data-form-submit-onvalidationerror");r!==undefined&&window[r]();return}n.createListItem(u).done(function(){var n=i.attr("data-form-submit-onsuccess");n!==undefined&&window[n]()}).fail(function(n){var t=i.attr("data-form-submit-onfailed");t!==undefined&&window[t](n)})})},i.prototype.populateFieldsFromQueryString=function(){var n=t.getParameters();n!==null&&n.forEach(function(n){if(n.key.indexOf("form-")>-1){var t=n.key.substring(5);$("[data-form-field="+t+"]").length>0&&$("[data-form-field="+t+"]").val(decodeURIComponent(n.value))}})},i.prototype.loadProfileData=function(){var i=this,t=!1;(this.fields.forEach(function(n){n.get_isProfileField()&&(t=!0)}),t)&&n.Profile.ProfileManager.getProfileAsync().done(function(n){i.fields.forEach(function(t){var i=t.get_profileProperty();switch(i){case 1:t.set_value(n.displayName);break;case 2:t.set_value(n.firstName);break;case 3:t.set_value(n.lastName);break;case 7:t.set_value(n.phone);break;case 6:t.set_value(n.department);break;case 8:t.set_value(n.title);break;case 4:t.set_value(n.email);break;case 5:t.set_value(n.company)}})})},i.prototype.validateControls=function(){var n=!0;return this.fields.forEach(function(t){if(!t.validate()){n=!1;return}}),n},i.prototype.createListItem=function(n){var u=this,t=$.Deferred(),i=new SP.ClientContext,f=i.get_web(),r=f.get_lists().getByTitle(n);return this.settings===null||this.settings.maxParticipants===undefined||this.settings.maxParticipants<1?this.createListItemInternal(t,i,r):(i.load(r,"ItemCount"),i.executeQueryAsync(function(){if(r.get_itemCount()>=u.settings.maxParticipants){t.reject("Error: MaxParticipants");return}u.createListItemInternal(t,i,r)},function(n,i){t.reject(i.get_message())})),t.promise()},i.prototype.createListItemInternal=function(n,t,i){var u=new SP.ListItemCreationInformation,r=i.addItem(u);this.fields.forEach(function(n){var f=n.get_name(),i=n.get_value(),u;n.get_type()===3&&(i!==null&&i!==""?(u=t.get_web(),i=u.ensureUser(i)):i=null);r.set_item(f,i)});r.update();t.executeQueryAsync(function(){n.resolve()},function(t,i){n.reject(i.get_message())})},i}(),t;n.FormManager=i;t=function(){function n(){}return n.getParameters=function(){var r=[],u=window.location.search.substring(1),t,n,i,f;if(u==="")return null;for(t=u.split("&"),n=0;n<t.length;n++)i=t[n].split("="),f={key:i[0],value:i[1]},r.push(f);return r},n.getSPVersion=function(){return _spPageContextInfo.webUIVersion===15?2013:2010},n}();n.Helper=t})(SPForms||(SPForms={}));Array.prototype.forEach||(Array.prototype.forEach=function(n){var r=this.length,i,t;if(typeof n!="function")throw new TypeError;for(i=arguments[1],t=0;t<r;t++)t in this&&n.call(i,this[t],t,this)});__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t;(function(t){var s,o,i,r,u,f,e;(function(n){n[n.Text=0]="Text";n[n.Radio=1]="Radio";n[n.DatePicker=2]="DatePicker";n[n.PeoplePicker=3]="PeoplePicker";n[n.DropDown=4]="DropDown"})(t.FormFieldType||(t.FormFieldType={}));s=t.FormFieldType,function(n){n[n.Unknown=0]="Unknown";n[n.DisplayName=1]="DisplayName";n[n.FirstName=2]="FirstName";n[n.LastName=3]="LastName";n[n.EMail=4]="EMail";n[n.Company=5]="Company";n[n.Department=6]="Department";n[n.Phone=7]="Phone";n[n.Title=8]="Title"}(t.ProfileProperty||(t.ProfileProperty={}));o=t.ProfileProperty;i=function(){function n(n){if(this.internalField=n,this.get_isrequired()){var t=$("label[for="+this.internalField.attr("id")+"]");t.length>0&&t.append('<span style="color: red;"> *<\/span>')}}return n.getFormField=function(t){switch(n.getFormFieldType(t)){case 1:return new r(t);case 3:return new u(t);case 2:return new f(t);case 4:return new e(t);case 0:default:return new n(t)}},n.getFormFieldType=function(n){if(n.get()[0].tagName.toLowerCase()==="select")return 4;var t=n.attr("type");switch(t){case"radio":return 1;case"text":default:return n.attr("data-form-peoplepicker")!==undefined?3:n.attr("data-form-datepicker")!==undefined?2:0}},n.prototype.get_name=function(){return this.internalField.attr("data-form-field")},n.prototype.get_type=function(){return n.getFormFieldType(this.internalField)},n.prototype.get_value=function(){return this.internalField.val()},n.prototype.set_value=function(n){this.internalField.val(n)},n.prototype.get_isrequired=function(){return this.internalField.is(":visible")?this.internalField.attr("data-form-required")!==undefined:!1},n.prototype.get_validatorExpression=function(){return this.internalField.attr("data-form-validate")},n.prototype.get_isProfileField=function(){return this.internalField.attr("data-form-profile")!==undefined},n.prototype.get_profileProperty=function(){try{return o[this.internalField.attr("data-form-profile")]}catch(n){return 0}},n.prototype.validate=function(){var t,n,i;return this.get_isrequired()&&this.get_value().length===0?(t=this.internalField.attr("data-form-validationmessage")||"Required",this.internalField.addClass("form-invalid"),this.internalField.tooltip({items:"[id="+this.internalField.attr("ID")+"]",content:t,disabled:!1}),!1):(n=this.get_validatorExpression(),n!==undefined&&(i=new RegExp(n),!i.test(this.get_value())))?(this.internalField.addClass("form-invalid"),this.internalField.tooltip({items:"[id="+this.internalField.attr("ID")+"]",content:this.internalField.attr("data-form-validationmessage"),disabled:!1}),!1):!0},n}();t.FormField=i;r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.get_value=function(){var n=this.internalField.attr("name");return $("[name="+n+"]:checked").val()},t}(i);t.RadioFormField=r;u=function(t){function i(i){var o=this,r,f,u,e;t.call(this,i);this.peoplePickerMode=n.Helper.getSPVersion();this.peoplePickerMode===2010?(this.internalField.prop("disabled","disabled"),this.peoplePicker2010=new n.PeoplePicker2010(this.internalField.attr("id")),r=$('<img src="/Scripts/images/addressbook.gif" style="margin-left: 5px; vertical-align: bottom; cursor: pointer;" />'),r.click(function(){o.peoplePicker2010.openPeoplePicker()}),this.internalField.after(r)):this.peoplePickerMode===2013&&(f=this.internalField.attr("id"),u=f+"_div",this.internalField.hide(),e=$('<div id="'+u+'"><\/div>'),this.internalField.after(e),this.peoplePicker2013=new n.PeoplePicker2013(u),this.peoplePicker2013.initAsync())}return __extends(i,t),i.prototype.get_value=function(){if(this.peoplePickerMode===2010)switch(this.internalField.attr("data-form-peoplepicker-value")){case"displayname":return this.internalField.attr("data-people-display");case"email":return this.internalField.attr("data-people-email");case"accountname":default:return this.internalField.attr("data-people-account")}else if(this.peoplePickerMode===2013)return this.peoplePicker2013.getSelectedAccountName()},i}(i);t.PeopleFormField=u;f=function(n){function t(t){n.call(this,t);this.internalField.datepicker()}return __extends(t,n),t}(i);t.DatePickerField=f;e=function(n){function t(t){n.call(this,t);this._valuesToElementItems=[];this._list=t.attr("data-form-select-list");this._valueColumn=t.attr("data-form-select-valueColumn");this._isLookup=this._list!==undefined&&this._list!==null&&this._list!=="";this._isLookup&&(this._initialOptionElements=$("option",t).detach(),this.parseValuesToElements(t.attr("data-form-select-setValuesToElements")),this.setupDependencies(),this.loadList(),this.wireupEvents())}return __extends(t,n),t.prototype.loadList=function(){var n=this,t=$.Deferred(),i=new SP.ClientContext,u=i.get_web(),f=u.get_lists().getByTitle(this._list),r=f.getItems(SP.CamlQuery.createAllItemsQuery());return this._spValueCache=[],$("option",this.internalField).remove(),this._initialOptionElements.appendTo(this.internalField),i.load(r),i.executeQueryAsync(function(){for(var f,i,o,e,u=0;u<r.get_count();u++)f=r.get_item(u),i=f.get_item(n._valueColumn),n._spFilterField===undefined||n._spFilterField===null||n._spFilterField===""?n.internalField.append('<option value="'+i+'">'+i+"<\/option>"):(o=f.get_item(n._spFilterField),n.internalField.append('<option value="'+i+'" data-form-filtervalue="'+o+'">'+i+"<\/option>")),e={key:i,spItems:[]},n._valuesToElementItems.forEach(function(n){var t={key:n.key,value:f.get_item(n.value)};e.spItems.push(t)}),n._spValueCache.push(e);t.resolve()},function(i,r){n.internalField.append('<option value="">ERROR: '+r.get_message()+"<\/option>");t.reject(r.get_message())}),t.promise()},t.prototype.wireupEvents=function(){var n=this;this.internalField.change(function(){var t=$("option:selected",n.internalField).val();n._spValueCache.forEach(function(n){n.key===t&&n.spItems.forEach(function(n){$("#"+n.key).text(n.value)})})})},t.prototype.setupDependencies=function(){var n=this.internalField.attr("data-form-select-dependency-filter"),t,r,i;n!==undefined&&n!==null&&n!==""&&(t=n.split("="),this._spFilterField=t[0],r=t[1],i=this,$("[data-form-field="+r+"]").change(function(){var n=this;i.loadList().done(function(){$("option[data-form-filtervalue]option[data-form-filtervalue!='"+$(n).val()+"']",i.internalField).remove()})}))},t.prototype.parseValuesToElements=function(n){var i,t,r,u;if(n!==undefined&&n!==null&&n!=="")for(i=n.split(","),t=0;t<i.length;t++)r=i[t].split("="),u={key:r[0],value:r[1]},this._valuesToElementItems.push(u)},t}(i);t.DropDownField=e})(t=n.FormFields||(n.FormFields={}))}(SPForms||(SPForms={})),function(n){var t=function(){function n(n){this.textBox=$("#"+n)}return n.prototype.openPeoplePicker=function(){var t=this,n="/_layouts/picker.aspx";n+="?MultiSelect=False";n+="&CustomProperty=User,SecGroup,SPGroup;;15;;;False";n+="&EntitySeparator=;";n+="&DialogTitle=Select People and Groups";n+="&DialogImage=/_layouts/images/ppeople.gif";n+="&PickerDialogType=Microsoft.SharePoint.WebControls.PeoplePickerDialog, Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c";n+="&DefaultSearch=";commonShowModalDialog(n,"resizable:yes; status:no; scroll:no; help:no; center:yes; dialogWidth :575px; dialogHeight :500px;",function(n){t.peoplePickerCallback(n)})},n.prototype.peoplePickerCallback=function(n){var r=$.parseXML(n),t=$(r),u=t.find("Entity").attr("Key"),i=t.find("Entity").attr("DisplayText"),f=t.find("Entity ExtraData ArrayOfDictionaryEntry"),e=f.find('Key:contains("Email")').next().text();this.textBox.val()!=null&&(this.textBox.val(i),this.textBox.attr("data-people-display",i),this.textBox.attr("data-people-account",u),this.textBox.attr("data-people-email",e),this.textBox.focus())},n}();n.PeoplePicker2010=t}(SPForms||(SPForms={})),function(n){var t=function(){function n(n){this.divId=n}return n.prototype.initAsync=function(){var n=this;SP.SOD.loadMultiple(["sp.js","sp.runtime.js","sp.core.js","clienttemplates.js"],function(){var t={};t.PrincipalAccountType="User,DL,SecGroup,SPGroup";t.SearchPrincipalSource=15;t.ResolvePrincipalSource=15;t.AllowMultipleValues=!1;t.MaximumEntitySuggestions=50;t.Width="280px";SPClientPeoplePicker.InitializeStandalonePeoplePicker(n.divId,null,t)})},n.prototype.getSelectedAccountName=function(){var t=SPClientPeoplePicker.SPClientPeoplePickerDict[this.divId+"_TopSpan"],n=t.GetAllUserInfo();return n.length==0?"":n[0].Key},n}();n.PeoplePicker2013=t}(SPForms||(SPForms={})),function(n){var t;(function(t){var i=function(){function i(){}return i.getProfileAsync=function(){return n.Helper.getSPVersion()===2013?t.ProfileManager2013.getProfileAsync():t.ProfileManager2010.getProfileAsync()},i}();t.ProfileManager=i})(t=n.Profile||(n.Profile={}))}(SPForms||(SPForms={})),function(n){var t;(function(n){var t=function(){function n(){}return n.getProfileAsync=function(){var t=$.Deferred(),n={},i={operation:"GetUserProfileByName",async:!0,completefunc:function(i){$(i.responseXML).SPFilterNode("PropertyData").each(function(){$(this).find("Name").text()==="PreferredName"&&(n.displayName=$(this).find("Value").text());$(this).find("Name").text()==="FirstName"&&(n.firstName=$(this).find("Value").text());$(this).find("Name").text()==="LastName"&&(n.lastName=$(this).find("Value").text());$(this).find("Name").text()==="WorkPhone"&&(n.phone=$(this).find("Value").text());$(this).find("Name").text()==="Department"&&(n.department=$(this).find("Value").text());$(this).find("Name").text()==="Title"&&(n.title=$(this).find("Value").text());$(this).find("Name").text()==="WorkEmail"&&(n.email=$(this).find("Value").text())});t.resolve(n)},accountName:$().SPServices.SPGetCurrentUser({fieldName:"Name"})};return $().SPServices(i),t.promise()},n}();n.ProfileManager2010=t})(t=n.Profile||(n.Profile={}))}(SPForms||(SPForms={})),function(n){var t;(function(n){var t=function(){function n(){}return n.getProfileAsync=function(){var t=$.Deferred(),n={};return SP.SOD.loadMultiple(["sp.js","userprofile"],function(){var i=SP.ClientContext.get_current(),u=new SP.UserProfiles.PeopleManager(i),r=i.get_web().get_currentUser();i.load(r);i.executeQueryAsync(function(){var o=r.get_loginName(),e=new SP.UserProfiles.UserProfilePropertiesForUser(i,o,["PreferredName","FirstName","LastName","WorkPhone","Department","Title","WorkEmail"]),f=u.getUserProfilePropertiesFor(e);i.load(e);i.executeQueryAsync(function(){n.displayName=f[0];n.firstName=f[1];n.lastName=f[2];n.phone=f[3];n.department=f[4];n.title=f[5];n.email=f[6];t.resolve(n)},function(){})},function(){})}),t.promise()},n}();n.ProfileManager2013=t})(t=n.Profile||(n.Profile={}))}(SPForms||(SPForms={}));
//# sourceMappingURL=SPForms.2010-2013.min.js.map
