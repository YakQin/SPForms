var __extends,SPForms;(function(n){var i=function(){function i(n){this.fields=[];this.form=$("#"+n)}return i.init=function(n){var t=new i(n);return t.initialize(),t},i.prototype.initialize=function(){var i=this,t=this.form.attr("data-form-settings");this.settings=t!==null&&t!==undefined?JSON.parse(t):null;this.form.find("[data-form-field]").each(function(t,r){var u=n.FormFields.FormField.getFormFieldByType($(r));i.fields.push(u)});this.wireUpEvents();this.populateFieldsFromQueryString();this.loadProfileData()},i.prototype.wireUpEvents=function(){var n=this;this.form.find("[data-form-submit]").click(function(t){var i=$(t.target),r=i.attr("data-form-submit-list");($("[data-form-field]").removeClass("form-invalid"),$("[data-form-field]").tooltip(),$("[data-form-field]").tooltip("option","disabled",!0),n.validateControls())&&n.createListItem(r).done(function(){var n=i.attr("data-form-submit-onsuccess");n!==undefined&&window[n]()}).fail(function(n){var t=i.attr("data-form-submit-onfailed");t!==undefined&&window[t](n)})})},i.prototype.populateFieldsFromQueryString=function(){var n=t.getParameters();n!==null&&n.forEach(function(n){if(n.key.indexOf("form-")>-1){var t=n.key.substring(5);$("[data-form-field="+t+"]").length>0&&$("[data-form-field="+t+"]").val(decodeURIComponent(n.value))}})},i.prototype.loadProfileData=function(){var i=this,t=!1;(this.fields.forEach(function(n){n.get_isProfileField()&&(t=!0)}),t)&&n.Profile.ProfileManager.getProfileAsync().done(function(n){i.fields.forEach(function(t){var i=t.get_profileProperty();switch(i){case 1:t.set_value(n.displayName);break;case 2:t.set_value(n.firstName);break;case 3:t.set_value(n.lastName);break;case 7:t.set_value(n.phone);break;case 6:t.set_value(n.department);break;case 8:t.set_value(n.title);break;case 4:t.set_value(n.email);break;case 5:t.set_value(n.company)}})})},i.prototype.validateControls=function(){var n=!0;return this.fields.forEach(function(t){if(!t.validate()){n=!1;return}}),n},i.prototype.createListItem=function(n){var u=this,t=$.Deferred(),i=new SP.ClientContext,f=i.get_web(),r=f.get_lists().getByTitle(n);return this.settings===null||this.settings.maxParticipants===undefined||this.settings.maxParticipants<1?this.createListItemInternal(t,i,r):(i.load(r,"ItemCount"),i.executeQueryAsync(function(){if(r.get_itemCount()>=u.settings.maxParticipants){t.reject("Error: MaxParticipants");return}u.createListItemInternal(t,i,r)},function(n,i){t.reject(i.get_message())})),t.promise()},i.prototype.createListItemInternal=function(n,t,i){var u=new SP.ListItemCreationInformation,r=i.addItem(u);this.fields.forEach(function(n){var f=n.get_name(),i=n.get_value(),u;n.get_type()===3&&(u=t.get_web(),i=u.ensureUser(i));r.set_item(f,i)});r.update();t.executeQueryAsync(function(){n.resolve()},function(t,i){n.reject(i.get_message())})},i}(),t;n.FormManager=i;t=function(){function n(){}return n.getParameters=function(){var r=[],u=window.location.search.substring(1),t,n,i,f;if(u==="")return null;for(t=u.split("&"),n=0;n<t.length;n++)i=t[n].split("="),f={key:i[0],value:i[1]},r.push(f);return r},n}()})(SPForms||(SPForms={}));Array.prototype.forEach||(Array.prototype.forEach=function(n){var r=this.length,i,t;if(typeof n!="function")throw new TypeError;for(i=arguments[1],t=0;t<r;t++)t in this&&n.call(i,this[t],t,this)});__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){var o,e,i,r,u,f;(function(n){n[n.Text=0]="Text";n[n.Radio=1]="Radio";n[n.DatePicker=2]="DatePicker";n[n.PeoplePicker=3]="PeoplePicker"})(t.FormFieldType||(t.FormFieldType={}));o=t.FormFieldType,function(n){n[n.Unknown=0]="Unknown";n[n.DisplayName=1]="DisplayName";n[n.FirstName=2]="FirstName";n[n.LastName=3]="LastName";n[n.EMail=4]="EMail";n[n.Company=5]="Company";n[n.Department=6]="Department";n[n.Phone=7]="Phone";n[n.Title=8]="Title"}(t.ProfileProperty||(t.ProfileProperty={}));e=t.ProfileProperty;i=function(){function n(n){if(this.internalField=n,this.get_isrequired()){var t=$("label[for="+this.internalField.attr("id")+"]");t.length>0&&t.append('<span style="color: red;"> *<\/span>')}}return n.getFormFieldByType=function(t){switch(n.get_type(t)){case 1:return new r(t);case 3:return new u(t);case 2:return new f(t);case 0:default:return new n(t)}},n.get_type=function(n){var t=n.attr("type");switch(t){case"radio":return 1;case"text":default:return n.attr("data-form-peoplepicker")!==undefined?3:n.attr("data-form-datepicker")!==undefined?2:0}},n.prototype.get_name=function(){return this.internalField.attr("data-form-field")},n.prototype.get_type=function(){return n.get_type(this.internalField)},n.prototype.get_value=function(){return this.internalField.val()},n.prototype.set_value=function(n){this.internalField.val(n)},n.prototype.get_isrequired=function(){return this.internalField.attr("data-form-required")!==undefined},n.prototype.get_validatorExpression=function(){return this.internalField.attr("data-form-validate")},n.prototype.get_isProfileField=function(){return this.internalField.attr("data-form-profile")!==undefined},n.prototype.get_profileProperty=function(){try{return e[this.internalField.attr("data-form-profile")]}catch(n){return 0}},n.prototype.validate=function(){var n,t;return this.get_isrequired()&&this.get_value().length===0?(this.internalField.addClass("form-invalid"),this.internalField.tooltip({items:"[id="+this.internalField.attr("ID")+"]",content:this.internalField.attr("data-form-validationmessage"),disabled:!1}),!1):(n=this.get_validatorExpression(),n!==undefined&&(t=new RegExp(n),!t.test(this.get_value())))?(this.internalField.addClass("form-invalid"),this.internalField.tooltip({items:"[id="+this.internalField.attr("ID")+"]",content:this.internalField.attr("data-form-validationmessage"),disabled:!1}),!1):!0},n}();t.FormField=i;r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.get_value=function(){var n=this.internalField.attr("name");return $("[name="+n+"]:checked").val()},t}(i);t.RadioFormField=r;u=function(t){function i(i){var o=this,r,f,u,e;t.call(this,i);this.peoplePickerMode=i.attr("data-form-peoplepicker");this.peoplePickerMode==="2010"?(this.internalField.prop("disabled","disabled"),this.peoplePicker2010=new n.PeoplePicker2010(this.internalField.attr("id")),r=$('<img src="/Scripts/images/addressbook.gif" style="margin-left: 5px; vertical-align: bottom; cursor: pointer;" />'),r.click(function(){o.peoplePicker2010.openPeoplePicker()}),this.internalField.after(r)):this.peoplePickerMode==="2013"&&(f=this.internalField.attr("id"),u=f+"_div",this.internalField.hide(),e=$('<div id="'+u+'"><\/div>'),this.internalField.after(e),this.peoplePicker2013=new n.PeoplePicker2013(u),this.peoplePicker2013.initAsync())}return __extends(i,t),i.prototype.get_value=function(){if(this.peoplePickerMode==="2010")switch(this.internalField.attr("data-form-peoplepicker-value")){case"displayname":return this.internalField.attr("data-people-display");case"email":return this.internalField.attr("data-people-email");case"accountname":default:return this.internalField.attr("data-people-account")}else if(this.peoplePickerMode==="2013")return this.peoplePicker2013.getSelectedAccountName()},i}(i);t.PeopleFormField=u;f=function(n){function t(t){n.call(this,t);this.internalField.datepicker()}return __extends(t,n),t}(i);t.DatePickerField=f})(n.FormFields||(n.FormFields={}));var t=n.FormFields}(SPForms||(SPForms={})),function(n){var t=function(){function n(n){this.textBox=$("#"+n)}return n.prototype.openPeoplePicker=function(){var t=this,n="/_layouts/picker.aspx";n+="?MultiSelect=False";n+="&CustomProperty=User,SecGroup,SPGroup;;15;;;False";n+="&EntitySeparator=;";n+="&DialogTitle=Select People and Groups";n+="&DialogImage=/_layouts/images/ppeople.gif";n+="&PickerDialogType=Microsoft.SharePoint.WebControls.PeoplePickerDialog, Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c";n+="&DefaultSearch=";commonShowModalDialog(n,"resizable:yes; status:no; scroll:no; help:no; center:yes; dialogWidth :575px; dialogHeight :500px;",function(n){t.peoplePickerCallback(n)})},n.prototype.peoplePickerCallback=function(n){var r=$.parseXML(n),t=$(r),u=t.find("Entity").attr("Key"),i=t.find("Entity").attr("DisplayText"),f=t.find("Entity ExtraData ArrayOfDictionaryEntry"),e=f.find('Key:contains("Email")').next().text();this.textBox.val()!=null&&(this.textBox.val(i),this.textBox.attr("data-people-display",i),this.textBox.attr("data-people-account",u),this.textBox.attr("data-people-email",e),this.textBox.focus())},n}();n.PeoplePicker2010=t}(SPForms||(SPForms={})),function(n){var t=function(){function n(n){this.divId=n}return n.prototype.initAsync=function(){var n=this;SP.SOD.loadMultiple(["sp.js","sp.runtime.js","sp.core.js","clienttemplates.js"],function(){var t={};t.PrincipalAccountType="User,DL,SecGroup,SPGroup";t.SearchPrincipalSource=15;t.ResolvePrincipalSource=15;t.AllowMultipleValues=!1;t.MaximumEntitySuggestions=50;t.Width="280px";SPClientPeoplePicker.InitializeStandalonePeoplePicker(n.divId,null,t)})},n.prototype.getSelectedAccountName=function(){var t=SPClientPeoplePicker.SPClientPeoplePickerDict[this.divId+"_TopSpan"],n=t.GetAllUserInfo();return n.length==0?"":n[0].Key},n}();n.PeoplePicker2013=t}(SPForms||(SPForms={})),function(n){(function(n){var t=function(){function n(){}return n.getProfileAsync=function(){var t=$.Deferred(),n={},i={operation:"GetUserProfileByName",async:!0,completefunc:function(i){$(i.responseXML).SPFilterNode("PropertyData").each(function(){$(this).find("Name").text()==="PreferredName"&&(n.displayName=$(this).find("Value").text());$(this).find("Name").text()==="FirstName"&&(n.firstName=$(this).find("Value").text());$(this).find("Name").text()==="LastName"&&(n.lastName=$(this).find("Value").text());$(this).find("Name").text()==="WorkPhone"&&(n.phone=$(this).find("Value").text());$(this).find("Name").text()==="Department"&&(n.department=$(this).find("Value").text());$(this).find("Name").text()==="Title"&&(n.title=$(this).find("Value").text());$(this).find("Name").text()==="WorkEmail"&&(n.email=$(this).find("Value").text());$(this).find("Name").text()==="otg-Company"&&(n.company=$(this).find("Value").text())});t.resolve(n)},accountName:$().SPServices.SPGetCurrentUser({fieldName:"Name"})};return $().SPServices(i),t.promise()},n}();n.ProfileManager=t})(n.Profile||(n.Profile={}));var t=n.Profile}(SPForms||(SPForms={}));
/*
//# sourceMappingURL=SPForms.min.js.map
*/